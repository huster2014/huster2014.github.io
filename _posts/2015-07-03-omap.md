---
layout: post
title: ceph osd中omap的实现
---

FileStore作为ObjectStore最重要的实现之一，封装了OSD底层所有I/O操作。FileStore不仅对外提供Object的读写接口，还提供了对Object属性(xattr)和关联kv(omap)的访问接口。xattr和omap都是与某个Object关联key-value对，在实现上xattr利用文件的xattr属性进行存取，而omap则利用DBObjectMap实现存取。由于文件系统在文件xattr长度上的限制，xattr溢出的部分就会被存放在DBObjectMap中，因而xattr和omap操作是互通，只不过前者的长度受限，而后者没有限制罢了。<br>

# DBObjectMap的0-copy clone 技术
DBObjectMap对外提供omap和xattr的操作接口，如set_，get_，rm_以及clone和sync接口。
